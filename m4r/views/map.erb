<script type="text/javascript" charset="utf-8">
	var proxy_host = "<%= PLATFORM_API_URL %>";
	var map = new F1.Maker.Map( { dom_id:"geoiq_map",map_id:<%= @country[:map].to_s %>, 
                                uiZoom: true,uiLayers: false,uiLegend: true,uiStyles: true,
                                uiHeader: true,hideGCLogo: true,hideGILogo: true,
                                ShowControl:("Legend",true,"open"),
                                core_host:  proxy_host + '/', finder_host:proxy_host + '/', maker_host: proxy_host + '/',
                                onload: function() { <%= @country[:projects].nil? ? "" : "drawCharts();" %> }
                              });

	function drawCharts() {
	  F1.Visualizer.utils.get_data_from_flash(<%= (@country[:projects] || 1) %>, function(data) {
		var features = jq.map(data.features, function(feature) { 
		  if (feature) { return feature.attributes} });
		  data.features = features;
		  F1.Visualizer.charts.grid(500, 930, data, "projects-table", ["project title", "project id", "total amt", "sector1", "approval date"]);

      // bar_options = {"features":features, "attributes": {"data":{"name": "Number of Projects", "original_name": "projects"}, "description":{"name": "Commune", "original_name": "commune"}, "sort":{"name": "Number of Projects","original_name": "projects"} } };
      // F1.Visualizer.charts.bar(180, 455, bar_options, "overall_funding");
      // 
      // pie_options = {"features":features, "attributes": {"data":{"name": "Number of Projects","original_name": "projects"}, "description":{"name": "Commune","original_name": "commune"}, "sort":{"name": "Number of Projects","original_name": "projects"} } };
      // F1.Visualizer.charts.pie(180, 455, pie_options, "funding_by_region");
		  }, map);
		}
</script>